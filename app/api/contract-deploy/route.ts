import { NextRequest, NextResponse } from "next/server";
import { metadata } from "../../../model/SmartContractMetadata";
import environmentSetup from "../../../lib/client";
import { ContractCreateFlow } from "@hashgraph/sdk";
import fs from 'fs';

async function createContract() {
    try {
        const client = await environmentSetup();
        
        const bytecode =
          "608060405234801561000f575f5ffd5b506001805f5f60078111156100275761002661035b565b5b60078111156100395761003861035b565b5b81526020019081526020015f2081905550600260015f600160078111156100635761006261035b565b5b60078111156100755761007461035b565b5b81526020019081526020015f2081905550600460015f6002600781111561009f5761009e61035b565b5b60078111156100b1576100b061035b565b5b81526020019081526020015f2081905550600860015f600360078111156100db576100da61035b565b5b60078111156100ed576100ec61035b565b5b81526020019081526020015f2081905550601060015f600460078111156101175761011661035b565b5b60078111156101295761012861035b565b5b81526020019081526020015f2081905550602060015f600560078111156101535761015261035b565b5b60078111156101655761016461035b565b5b81526020019081526020015f2081905550604060015f6006600781111561018f5761018e61035b565b5b60078111156101a1576101a061035b565b5b81526020019081526020015f2081905550608060015f6007808111156101ca576101c961035b565b5b60078111156101dc576101db61035b565b5b81526020019081526020015f20819055506040518060400160405280600b81526020017f636572746966696361746500000000000000000000000000000000000000000081525060025f6001600281111561023a5761023961035b565b5b600281111561024c5761024b61035b565b5b81526020019081526020015f20908161026591906105c5565b506040518060400160405280600781526020017f6469706c6f6d610000000000000000000000000000000000000000000000000081525060025f5f60028111156102b2576102b161035b565b5b60028111156102c4576102c361035b565b5b81526020019081526020015f2090816102dd91906105c5565b506040518060400160405280600581526020017f626164676500000000000000000000000000000000000000000000000000000081525060025f60028081111561032a5761032961035b565b5b600281111561033c5761033b61035b565b5b81526020019081526020015f20908161035591906105c5565b50610694565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52602160045260245ffd5b5f81519050919050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52604160045260245ffd5b7f4e487b71000000000000000000000000000000000000000000000000000000005f52602260045260245ffd5b5f600282049050600182168061040357607f821691505b602082108103610416576104156103bf565b5b50919050565b5f819050815f5260205f209050919050565b5f6020601f8301049050919050565b5f82821b905092915050565b5f600883026104787fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff8261043d565b610482868361043d565b95508019841693508086168417925050509392505050565b5f819050919050565b5f819050919050565b5f6104c66104c16104bc8461049a565b6104a3565b61049a565b9050919050565b5f819050919050565b6104df836104ac565b6104f36104eb826104cd565b848454610449565b825550505050565b5f5f905090565b61050a6104fb565b6105158184846104d6565b505050565b5b818110156105385761052d5f82610502565b60018101905061051b565b5050565b601f82111561057d5761054e8161041c565b6105578461042e565b81016020851015610566578190505b61057a6105728561042e565b83018261051a565b50505b505050565b5f82821c905092915050565b5f61059d5f1984600802610582565b1980831691505092915050565b5f6105b5838361058e565b9150826002028217905092915050565b6105ce82610388565b67ffffffffffffffff8111156105e7576105e6610392565b5b6105f182546103ec565b6105fc82828561053c565b5f60209050601f83116001811461062d575f841561061b578287015190505b61062585826105aa565b86555061068c565b601f19841661063b8661041c565b5f5b828110156106625784890151825560018201915060208501945060208101905061063d565b8683101561067f578489015161067b601f89168261058e565b8355505b6001600288020188555050505b505050505050565b613835806106a15f395ff3fe608060405260043610610090575f3560e01c8063618dc65e11610058578063618dc65e146101b45780636e2ae8f2146101f157806375fd16061461022d5780639b23d3d914610269578063a3ad9d6b146102a557610090565b80630fcaca1f1461009457806315dacbea146100d05780632543c9371461010c5780632b9bed8d146101485780632ccff29514610184575b5f5ffd5b34801561009f575f5ffd5b506100ba60048036038101906100b59190611b9d565b6102e1565b6040516100c79190611c34565b60405180910390f35b3480156100db575f5ffd5b506100f660048036038101906100f19190611c80565b6103f6565b6040516101039190611c34565b60405180910390f35b348015610117575f5ffd5b50610132600480360381019061012d9190611dc2565b61050e565b60405161013f9190611c34565b60405180910390f35b348015610153575f5ffd5b5061016e60048036038101906101699190611e1c565b61058c565b60405161017b9190611c34565b60405180910390f35b61019e60048036038101906101999190611f14565b6105ef565b6040516101ab9190611f8f565b60405180910390f35b3480156101bf575f5ffd5b506101da60048036038101906101d59190611fa8565b610781565b6040516101e892919061207a565b60405180910390f35b3480156101fc575f5ffd5b50610217600480360381019061021291906121ab565b6108d6565b604051610224919061236c565b60405180910390f35b348015610238575f5ffd5b50610253600480360381019061024e919061238c565b610d49565b60405161026091906123dc565b60405180910390f35b348015610274575f5ffd5b5061028f600480360381019061028a9190611c80565b610daa565b60405161029c9190611c34565b60405180910390f35b3480156102b0575f5ffd5b506102cb60048036038101906102c69190612418565b610ec2565b6040516102d891906124e2565b60405180910390f35b5f5f5f61016c73ffffffffffffffffffffffffffffffffffffffff16630fcaca1f60e01b87878760405160240161031a939291906125b2565b604051602081830303815290604052907bffffffffffffffffffffffffffffffffffffffffffffffffffffffff19166020820180517bffffffffffffffffffffffffffffffffffffffffffffffffffffffff8381831617835250505050604051610384919061262f565b5f604051808303815f865af19150503d805f81146103bd576040519150601f19603f3d011682016040523d82523d5f602084013e6103c2565b606091505b5091509150816103d35760156103e8565b808060200190518101906103e7919061267b565b5b60030b925050509392505050565b5f5f5f61016c73ffffffffffffffffffffffffffffffffffffffff166315dacbea60e01b8888888860405160240161043194939291906126b5565b604051602081830303815290604052907bffffffffffffffffffffffffffffffffffffffffffffffffffffffff19166020820180517bffffffffffffffffffffffffffffffffffffffffffffffffffffffff838183161783525050505060405161049b919061262f565b5f604051808303815f865af19150503d805f81146104d4576040519150601f19603f3d011682016040523d82523d5f602084013e6104d9565b606091505b5091509150816104ea5760156104ff565b808060200190518101906104fe919061267b565b5b60030b92505050949350505050565b5f5f5f61051c855f86611006565b9250509150601660030b8214610567576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161055e90612778565b60405180910390fd5b805f8151811061057a57610579612796565b5b60200260200101519250505092915050565b5f5f5f61059a855f86611177565b91509150601660030b82146105e4576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016105db90612833565b60405180910390fd5b809250505092915050565b5f5f600167ffffffffffffffff81111561060c5761060b61197b565b5b60405190808252806020026020018201604052801561064557816020015b6106326117d7565b81526020019060019003908161062a5790505b5090506106556004600130611298565b815f8151811061066857610667612796565b5b602002602001018190525061067b6117f6565b85815f01819052508560405160200161069491906128bb565b604051602081830303815290604052816020018190525084816040019073ffffffffffffffffffffffffffffffffffffffff16908173ffffffffffffffffffffffffffffffffffffffff16815250505f816080019015159081151581525050838160a0019060070b908160070b81525050818160e001819052505f8160c00190151590811515815250505f5f610729836112cf565b91509150601660030b8214610773576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161076a90612950565b60405180910390fd5b809450505050509392505050565b5f60605f5f61016c73ffffffffffffffffffffffffffffffffffffffff1663618dc65e60e01b87876040516024016107ba92919061296e565b604051602081830303815290604052907bffffffffffffffffffffffffffffffffffffffffffffffffffffffff19166020820180517bffffffffffffffffffffffffffffffffffffffffffffffffffffffff8381831617835250505050604051610824919061262f565b5f604051808303815f865af19150503d805f811461085d576040519150601f19603f3d011682016040523d82523d5f602084013e610862565b606091505b50915091507f4af4780e06fe8cb9df64b0794fa6f01399af979175bb988e35e0e57e594567bc82826040516108989291906129b6565b60405180910390a1816108bb57601560405180602001604052805f8152506108bf565b6016815b8160030b9150809450819550505050509250929050565b60605f60038c8c6040516108eb929190612a08565b90815260200160405180910390205f01805461090690612a4d565b905014610948576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161093f90612ac7565b60405180910390fd5b5f8367ffffffffffffffff8111156109635761096261197b565b5b6040519080825280602002602001820160405280156109915781602001602082028036833780820191505090505b50905060405180604001604052808b8b8080601f0160208091040260200160405190810160405280939291908181526020018383808284375f81840152601f19601f8201169050808301925050505050505081526020018473ffffffffffffffffffffffffffffffffffffffff1681525060038d8d604051610a14929190612a08565b90815260200160405180910390205f820151815f019081610a359190612c85565b506020820151816001015f6101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055509050505f5f90505b84811015610d36575f8d8d60025f8d8d87818110610aa557610aa4612796565b5b9050602002016020810190610aba9190612d54565b6002811115610acc57610acb612d7f565b5b6002811115610ade57610add612d7f565b5b81526020019081526020015f20604051602001610afd93929190612e52565b60405160208183030381529060405290505f610b4182878b8b87818110610b2757610b26612796565b5b9050602002016020810190610b3c9190612e86565b6105ef565b905060405180606001604052808a8a86818110610b6157610b60612796565b5b9050602002016020810190610b769190612e86565b60070b81526020018c8c86818110610b9157610b90612796565b5b9050602002016020810190610ba69190612d54565b6002811115610bb857610bb7612d7f565b5b81526020018273ffffffffffffffffffffffffffffffffffffffff16815250600483604051610be79190612eb1565b90815260200160405180910390205f820151815f015f6101000a81548167ffffffffffffffff021916908360070b67ffffffffffffffff1602179055506020820151815f0160086101000a81548160ff02191690836002811115610c4e57610c4d612d7f565b5b02179055506040820151815f0160096101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055509050507fa41e3677e9d3ecc54f074c7abd815a9cc2e9cc1439efe4e43fe54c25ab6a8075818e8e42604051610cd19493929190612ef3565b60405180910390a180848481518110610ced57610cec612796565b5b602002602001019073ffffffffffffffffffffffffffffffffffffffff16908173ffffffffffffffffffffffffffffffffffffffff168152505050508080600101915050610a84565b50809150509a9950505050505050505050565b5f5f610d5785308686611435565b9050601660030b8114610d9f576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610d9690612fa1565b60405180910390fd5b809150509392505050565b5f5f5f61016c73ffffffffffffffffffffffffffffffffffffffff16639b23d3d960e01b88888888604051602401610de594939291906126b5565b604051602081830303815290604052907bffffffffffffffffffffffffffffffffffffffffffffffffffffffff19166020820180517bffffffffffffffffffffffffffffffffffffffffffffffffffffffff8381831617835250505050604051610e4f919061262f565b5f604051808303815f865af19150503d805f8114610e88576040519150601f19603f3d011682016040523d82523d5f602084013e610e8d565b606091505b509150915081610e9e576015610eb3565b80806020019051810190610eb2919061267b565b5b60030b92505050949350505050565b5f5f858560025f876002811115610edc57610edb612d7f565b5b6002811115610eee57610eed612d7f565b5b81526020019081526020015f20604051602001610f0d93929190612e52565b60405160208183030381529060405290505f600482604051610f2f9190612eb1565b90815260200160405180910390205f0160099054906101000a900473ffffffffffffffffffffffffffffffffffffffff1690505f610f6d828661050e565b9050610f79898361154d565b50610f858a8383610d49565b505f8a828a8a604051602001610f9e9493929190613038565b6040516020818303038152906040528051906020012090507ffcea6d591fc2d5b735b8c521cdbdaf03022bf5949eda709b18ef3ece8f31b1f48b8a8a8642604051610fed959493929190613072565b60405180910390a1809450505050509695505050505050565b5f5f60605f5f61016c73ffffffffffffffffffffffffffffffffffffffff1663e0f4059a60e01b898989604051602401611042939291906131c1565b604051602081830303815290604052907bffffffffffffffffffffffffffffffffffffffffffffffffffffffff19166020820180517bffffffffffffffffffffffffffffffffffffffffffffffffffffffff83818316178352505050506040516110ac919061262f565b5f604051808303815f865af19150503d805f81146110e5576040519150601f19603f3d011682016040523d82523d5f602084013e6110ea565b606091505b5091509150816111455760155f5f67ffffffffffffffff8111156111115761111061197b565b5b60405190808252806020026020018201604052801561113f5781602001602082028036833780820191505090505b5061115a565b8080602001905181019061115991906132a6565b5b8260030b9250809550819650829750505050505093509350939050565b5f5f5f5f61016c73ffffffffffffffffffffffffffffffffffffffff1663d6910d0660e01b8888886040516024016111b193929190613312565b604051602081830303815290604052907bffffffffffffffffffffffffffffffffffffffffffffffffffffffff19166020820180517bffffffffffffffffffffffffffffffffffffffffffffffffffffffff838183161783525050505060405161121b919061262f565b5f604051808303815f865af19150503d805f8114611254576040519150601f19603f3d011682016040523d82523d5f602084013e611259565b606091505b50915091508161126b5760155f611280565b8080602001905181019061127f919061334e565b5b8160030b915080945081955050505050935093915050565b6112a06117d7565b60405180604001604052806112b4866115ab565b81526020016112c385856115e9565b81525090509392505050565b5f5f825f8161010001515f015160070b1480156112f757505f8161010001516040015160070b145b1561131a576276a70060030b8161010001516040019060070b908160070b815250505b5f5f61016c73ffffffffffffffffffffffffffffffffffffffff163463ad7f8f0b60e01b8860405160240161134f9190613694565b604051602081830303815290604052907bffffffffffffffffffffffffffffffffffffffffffffffffffffffff19166020820180517bffffffffffffffffffffffffffffffffffffffffffffffffffffffff83818316178352505050506040516113b9919061262f565b5f6040518083038185875af1925050503d805f81146113f3576040519150601f19603f3d011682016040523d82523d5f602084013e6113f8565b606091505b50915091508161140a5760155f61141f565b8080602001905181019061141e91906136ef565b5b8160030b91508095508196505050505050915091565b5f5f5f61016c73ffffffffffffffffffffffffffffffffffffffff16635cfc901160e01b88888888604051602401611470949392919061372d565b604051602081830303815290604052907bffffffffffffffffffffffffffffffffffffffffffffffffffffffff19166020820180517bffffffffffffffffffffffffffffffffffffffffffffffffffffffff83818316178352505050506040516114da919061262f565b5f604051808303815f865af19150503d805f8114611513576040519150601f19603f3d011682016040523d82523d5f602084013e611518565b606091505b50915091508161152957601561153e565b8080602001905181019061153d919061267b565b5b60030b92505050949350505050565b5f5f61155984846116c5565b9050601660030b81146115a1576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401611598906137ba565b60405180910390fd5b8091505092915050565b5f60015f8360078111156115c2576115c1612d7f565b5b60078111156115d4576115d3612d7f565b5b81526020019081526020015f20549050919050565b6115f1611868565b6001600481111561160557611604612d7f565b5b83600481111561161857611617612d7f565b5b0361165a5781816020019073ffffffffffffffffffffffffffffffffffffffff16908173ffffffffffffffffffffffffffffffffffffffff16815250506116bf565b60048081111561166d5761166c612d7f565b5b8360048111156116805761167f612d7f565b5b036116be5781816080019073ffffffffffffffffffffffffffffffffffffffff16908173ffffffffffffffffffffffffffffffffffffffff16815250505b5b92915050565b5f5f5f61016c73ffffffffffffffffffffffffffffffffffffffff166349146bde60e01b86866040516024016116fc9291906137d8565b604051602081830303815290604052907bffffffffffffffffffffffffffffffffffffffffffffffffffffffff19166020820180517bffffffffffffffffffffffffffffffffffffffffffffffffffffffff8381831617835250505050604051611766919061262f565b5f604051808303815f865af19150503d805f811461179f576040519150601f19603f3d011682016040523d82523d5f602084013e6117a4565b606091505b5091509150816117b55760156117ca565b808060200190518101906117c9919061267b565b5b60030b9250505092915050565b60405180604001604052805f81526020016117f0611868565b81525090565b60405180610140016040528060608152602001606081526020015f73ffffffffffffffffffffffffffffffffffffffff168152602001606081526020015f151581526020015f60070b81526020015f151581526020016060815260200161185b6118c2565b8152602001606081525090565b6040518060a001604052805f151581526020015f73ffffffffffffffffffffffffffffffffffffffff16815260200160608152602001606081526020015f73ffffffffffffffffffffffffffffffffffffffff1681525090565b60405180606001604052805f60070b81526020015f73ffffffffffffffffffffffffffffffffffffffff1681526020015f60070b81525090565b5f604051905090565b5f5ffd5b5f5ffd5b5f73ffffffffffffffffffffffffffffffffffffffff82169050919050565b5f6119368261190d565b9050919050565b6119468161192c565b8114611950575f5ffd5b50565b5f813590506119618161193d565b92915050565b5f5ffd5b5f601f19601f8301169050919050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52604160045260245ffd5b6119b18261196b565b810181811067ffffffffffffffff821117156119d0576119cf61197b565b5b80604052505050565b5f6119e26118fc565b90506119ee82826119a8565b919050565b5f67ffffffffffffffff821115611a0d57611a0c61197b565b5b602082029050602081019050919050565b5f5ffd5b5f8160070b9050919050565b611a3781611a22565b8114611a41575f5ffd5b50565b5f81359050611a5281611a2e565b92915050565b5f611a6a611a65846119f3565b6119d9565b90508083825260208201905060208402830185811115611a8d57611a8c611a1e565b5b835b81811015611ab65780611aa28882611a44565b845260208401935050602081019050611a8f565b5050509392505050565b5f82601f830112611ad457611ad3611967565b5b8135611ae4848260208601611a58565b91505092915050565b5f5ffd5b5f67ffffffffffffffff821115611b0b57611b0a61197b565b5b611b148261196b565b9050602081019050919050565b828183375f83830152505050565b5f611b41611b3c84611af1565b6119d9565b905082815260208101848484011115611b5d57611b5c611aed565b5b611b68848285611b21565b509392505050565b5f82601f830112611b8457611b83611967565b5b8135611b94848260208601611b2f565b91505092915050565b5f5f5f60608486031215611bb457611bb3611905565b5b5f611bc186828701611953565b935050602084013567ffffffffffffffff811115611be257611be1611909565b5b611bee86828701611ac0565b925050604084013567ffffffffffffffff811115611c0f57611c0e611909565b5b611c1b86828701611b70565b9150509250925092565b611c2e81611a22565b82525050565b5f602082019050611c475f830184611c25565b92915050565b5f819050919050565b611c5f81611c4d565b8114611c69575f5ffd5b50565b5f81359050611c7a81611c56565b92915050565b5f5f5f5f60808587031215611c9857611c97611905565b5b5f611ca587828801611953565b9450506020611cb687828801611953565b9350506040611cc787828801611953565b9250506060611cd887828801611c6c565b91505092959194509250565b5f67ffffffffffffffff821115611cfe57611cfd61197b565b5b602082029050602081019050919050565b5f611d21611d1c84611ce4565b6119d9565b90508083825260208201905060208402830185811115611d4457611d43611a1e565b5b835b81811015611d8b57803567ffffffffffffffff811115611d6957611d68611967565b5b808601611d768982611b70565b85526020850194505050602081019050611d46565b5050509392505050565b5f82601f830112611da957611da8611967565b5b8135611db9848260208601611d0f565b91505092915050565b5f5f60408385031215611dd857611dd7611905565b5b5f611de585828601611953565b925050602083013567ffffffffffffffff811115611e0657611e05611909565b5b611e1285828601611d95565b9150509250929050565b5f5f60408385031215611e3257611e31611905565b5b5f611e3f85828601611953565b925050602083013567ffffffffffffffff811115611e6057611e5f611909565b5b611e6c85828601611ac0565b9150509250929050565b5f67ffffffffffffffff821115611e9057611e8f61197b565b5b611e998261196b565b9050602081019050919050565b5f611eb8611eb384611e76565b6119d9565b905082815260208101848484011115611ed457611ed3611aed565b5b611edf848285611b21565b509392505050565b5f82601f830112611efb57611efa611967565b5b8135611f0b848260208601611ea6565b91505092915050565b5f5f5f60608486031215611f2b57611f2a611905565b5b5f84013567ffffffffffffffff811115611f4857611f47611909565b5b611f5486828701611ee7565b9350506020611f6586828701611953565b9250506040611f7686828701611a44565b9150509250925092565b611f898161192c565b82525050565b5f602082019050611fa25f830184611f80565b92915050565b5f5f60408385031215611fbe57611fbd611905565b5b5f611fcb85828601611953565b925050602083013567ffffffffffffffff811115611fec57611feb611909565b5b611ff885828601611b70565b9150509250929050565b5f819050919050565b61201481612002565b82525050565b5f81519050919050565b5f82825260208201905092915050565b8281835e5f83830152505050565b5f61204c8261201a565b6120568185612024565b9350612066818560208601612034565b61206f8161196b565b840191505092915050565b5f60408201905061208d5f83018561200b565b818103602083015261209f8184612042565b90509392505050565b5f5ffd5b5f5f83601f8401126120c1576120c0611967565b5b8235905067ffffffffffffffff8111156120de576120dd6120a8565b5b6020830191508360018202830111156120fa576120f9611a1e565b5b9250929050565b5f5f83601f84011261211657612115611967565b5b8235905067ffffffffffffffff811115612133576121326120a8565b5b60208301915083602082028301111561214f5761214e611a1e565b5b9250929050565b5f5f83601f84011261216b5761216a611967565b5b8235905067ffffffffffffffff811115612188576121876120a8565b5b6020830191508360208202830111156121a4576121a3611a1e565b5b9250929050565b5f5f5f5f5f5f5f5f5f5f60c08b8d0312156121c9576121c8611905565b5b5f8b013567ffffffffffffffff8111156121e6576121e5611909565b5b6121f28d828e016120ac565b9a509a505060208b013567ffffffffffffffff81111561221557612214611909565b5b6122218d828e016120ac565b985098505060408b013567ffffffffffffffff81111561224457612243611909565b5b6122508d828e01612101565b965096505060608b013567ffffffffffffffff81111561227357612272611909565b5b61227f8d828e01612156565b945094505060806122928d828e01611c6c565b92505060a06122a38d828e01611953565b9150509295989b9194979a5092959850565b5f81519050919050565b5f82825260208201905092915050565b5f819050602082019050919050565b6122e78161192c565b82525050565b5f6122f883836122de565b60208301905092915050565b5f602082019050919050565b5f61231a826122b5565b61232481856122bf565b935061232f836122cf565b805f5b8381101561235f57815161234688826122ed565b975061235183612304565b925050600181019050612332565b5085935050505092915050565b5f6020820190508181035f8301526123848184612310565b905092915050565b5f5f5f606084860312156123a3576123a2611905565b5b5f6123b086828701611953565b93505060206123c186828701611953565b92505060406123d286828701611a44565b9150509250925092565b5f6020820190506123ef5f83018461200b565b92915050565b60038110612401575f5ffd5b50565b5f81359050612412816123f5565b92915050565b5f5f5f5f5f5f60a0878903121561243257612431611905565b5b5f61243f89828a01611953565b965050602061245089828a01611953565b955050604087013567ffffffffffffffff81111561247157612470611909565b5b61247d89828a016120ac565b9450945050606061249089828a01612404565b925050608087013567ffffffffffffffff8111156124b1576124b0611909565b5b6124bd89828a01611d95565b9150509295509295509295565b5f819050919050565b6124dc816124ca565b82525050565b5f6020820190506124f55f8301846124d3565b92915050565b5f81519050919050565b5f82825260208201905092915050565b5f819050602082019050919050565b61252d81611a22565b82525050565b5f61253e8383612524565b60208301905092915050565b5f602082019050919050565b5f612560826124fb565b61256a8185612505565b935061257583612515565b805f5b838110156125a557815161258c8882612533565b97506125978361254a565b925050600181019050612578565b5085935050505092915050565b5f6060820190506125c55f830186611f80565b81810360208301526125d78185612556565b905081810360408301526125eb8184612042565b9050949350505050565b5f81905092915050565b5f6126098261201a565b61261381856125f5565b9350612623818560208601612034565b80840191505092915050565b5f61263a82846125ff565b915081905092915050565b5f8160030b9050919050565b61265a81612645565b8114612664575f5ffd5b50565b5f8151905061267581612651565b92915050565b5f602082840312156126905761268f611905565b5b5f61269d84828501612667565b91505092915050565b6126af81611c4d565b82525050565b5f6080820190506126c85f830187611f80565b6126d56020830186611f80565b6126e26040830185611f80565b6126ef60608301846126a6565b95945050505050565b5f82825260208201905092915050565b7f4661696c656420746f206d696e74206e6f6e2d66756e6769626c6520746f6b655f8201527f6e00000000000000000000000000000000000000000000000000000000000000602082015250565b5f6127626021836126f8565b915061276d82612708565b604082019050919050565b5f6020820190508181035f83015261278f81612756565b9050919050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52603260045260245ffd5b7f4661696c656420746f206275726e206e6f6e2d66756e6769626c6520746f6b655f8201527f6e00000000000000000000000000000000000000000000000000000000000000602082015250565b5f61281d6021836126f8565b9150612828826127c3565b604082019050919050565b5f6020820190508181035f83015261284a81612811565b9050919050565b7f2400000000000000000000000000000000000000000000000000000000000000815250565b5f81519050919050565b5f81905092915050565b5f61289582612877565b61289f8185612881565b93506128af818560208601612034565b80840191505092915050565b5f6128c582612851565b6001820191506128d5828461288b565b915081905092915050565b7f4661696c656420746f20637265617465206e6f6e2d66756e6769626c6520746f5f8201527f6b656e0000000000000000000000000000000000000000000000000000000000602082015250565b5f61293a6023836126f8565b9150612945826128e0565b604082019050919050565b5f6020820190508181035f8301526129678161292e565b9050919050565b5f6040820190506129815f830185611f80565b81810360208301526129938184612042565b90509392505050565b5f8115159050919050565b6129b08161299c565b82525050565b5f6040820190506129c95f8301856129a7565b81810360208301526129db8184612042565b90509392505050565b5f6129ef8385612881565b93506129fc838584611b21565b82840190509392505050565b5f612a148284866129e4565b91508190509392505050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52602260045260245ffd5b5f6002820490506001821680612a6457607f821691505b602082108103612a7757612a76612a20565b5b50919050565b7f43616e20637265617465206475706c6963617465204e465473000000000000005f82015250565b5f612ab16019836126f8565b9150612abc82612a7d565b602082019050919050565b5f6020820190508181035f830152612ade81612aa5565b9050919050565b5f819050815f5260205f209050919050565b5f6020601f8301049050919050565b5f82821b905092915050565b5f60088302612b417fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff82612b06565b612b4b8683612b06565b95508019841693508086168417925050509392505050565b5f819050919050565b5f612b86612b81612b7c84611c4d565b612b63565b611c4d565b9050919050565b5f819050919050565b612b9f83612b6c565b612bb3612bab82612b8d565b848454612b12565b825550505050565b5f5f905090565b612bca612bbb565b612bd5818484612b96565b505050565b5b81811015612bf857612bed5f82612bc2565b600181019050612bdb565b5050565b601f821115612c3d57612c0e81612ae5565b612c1784612af7565b81016020851015612c26578190505b612c3a612c3285612af7565b830182612bda565b50505b505050565b5f82821c905092915050565b5f612c5d5f1984600802612c42565b1980831691505092915050565b5f612c758383612c4e565b9150826002028217905092915050565b612c8e82612877565b67ffffffffffffffff811115612ca757612ca661197b565b5b612cb18254612a4d565b612cbc828285612bfc565b5f60209050601f831160018114612ced575f8415612cdb578287015190505b612ce58582612c6a565b865550612d4c565b601f198416612cfb86612ae5565b5f5b82811015612d2257848901518255600182019150602085019450602081019050612cfd565b86831015612d3f5784890151612d3b601f891682612c4e565b8355505b6001600288020188555050505b505050505050565b5f60208284031215612d6957612d68611905565b5b5f612d7684828501612404565b91505092915050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52602160045260245ffd5b7f2d00000000000000000000000000000000000000000000000000000000000000815250565b5f8154612dde81612a4d565b612de88186612881565b9450600182165f8114612e025760018114612e1757612e49565b60ff1983168652811515820286019350612e49565b612e2085612ae5565b5f5b83811015612e4157815481890152600182019150602081019050612e22565b838801955050505b50505092915050565b5f612e5e8285876129e4565b9150612e6982612dac565b600182019150612e798284612dd2565b9150819050949350505050565b5f60208284031215612e9b57612e9a611905565b5b5f612ea884828501611a44565b91505092915050565b5f612ebc828461288b565b915081905092915050565b5f612ed283856126f8565b9350612edf838584611b21565b612ee88361196b565b840190509392505050565b5f606082019050612f065f830187611f80565b8181036020830152612f19818587612ec7565b9050612f2860408301846126a6565b95945050505050565b7f4661696c656420746f207472616e73666572206e6f6e2d66756e6769626c65205f8201527f746f6b656e000000000000000000000000000000000000000000000000000000602082015250565b5f612f8b6025836126f8565b9150612f9682612f31565b604082019050919050565b5f6020820190508181035f830152612fb881612f7f565b9050919050565b5f8160601b9050919050565b5f612fd582612fbf565b9050919050565b5f612fe682612fcb565b9050919050565b612ffe612ff98261192c565b612fdc565b82525050565b5f8160c01b9050919050565b5f61301a82613004565b9050919050565b61303261302d82611a22565b613010565b82525050565b5f6130438287612fed565b6014820191506130538286613021565b6008820191506130648284866129e4565b915081905095945050505050565b5f6080820190506130855f830188611f80565b8181036020830152613098818688612ec7565b90506130a76040830185611f80565b6130b460608301846126a6565b9695505050505050565b5f81519050919050565b5f82825260208201905092915050565b5f819050602082019050919050565b5f82825260208201905092915050565b5f6131018261201a565b61310b81856130e7565b935061311b818560208601612034565b6131248161196b565b840191505092915050565b5f61313a83836130f7565b905092915050565b5f602082019050919050565b5f613158826130be565b61316281856130c8565b935083602082028501613174856130d8565b805f5b858110156131af5784840389528151613190858261312f565b945061319b83613142565b925060208a01995050600181019050613177565b50829750879550505050505092915050565b5f6060820190506131d45f830186611f80565b6131e16020830185611c25565b81810360408301526131f3818461314e565b9050949350505050565b5f8151905061320b81611a2e565b92915050565b5f61322361321e846119f3565b6119d9565b9050808382526020820190506020840283018581111561324657613245611a1e565b5b835b8181101561326f578061325b88826131fd565b845260208401935050602081019050613248565b5050509392505050565b5f82601f83011261328d5761328c611967565b5b815161329d848260208601613211565b91505092915050565b5f5f5f606084860312156132bd576132bc611905565b5b5f6132ca86828701612667565b93505060206132db868287016131fd565b925050604084015167ffffffffffffffff8111156132fc576132fb611909565b5b61330886828701613279565b9150509250925092565b5f6060820190506133255f830186611f80565b6133326020830185611c25565b81810360408301526133448184612556565b9050949350505050565b5f5f6040838503121561336457613363611905565b5b5f61337185828601612667565b9250506020613382858286016131fd565b9150509250929050565b5f82825260208201905092915050565b5f6133a682612877565b6133b0818561338c565b93506133c0818560208601612034565b6133c98161196b565b840191505092915050565b6133dd8161299c565b82525050565b5f81519050919050565b5f82825260208201905092915050565b5f819050602082019050919050565b61341581611c4d565b82525050565b5f60a083015f8301516134305f8601826133d4565b50602083015161344360208601826122de565b506040830151848203604086015261345b82826130f7565b9150506060830151848203606086015261347582826130f7565b915050608083015161348a60808601826122de565b508091505092915050565b5f604083015f8301516134aa5f86018261340c565b50602083015184820360208601526134c2828261341b565b9150508091505092915050565b5f6134da8383613495565b905092915050565b5f602082019050919050565b5f6134f8826133e3565b61350281856133ed565b935083602082028501613514856133fd565b805f5b8581101561354f578484038952815161353085826134cf565b945061353b836134e2565b925060208a01995050600181019050613517565b50829750879550505050505092915050565b606082015f8201516135755f850182612524565b50602082015161358860208501826122de565b50604082015161359b6040850182612524565b50505050565b5f61018083015f8301518482035f8601526135bc828261339c565b915050602083015184820360208601526135d6828261339c565b91505060408301516135eb60408601826122de565b5060608301518482036060860152613603828261339c565b915050608083015161361860808601826133d4565b5060a083015161362b60a0860182612524565b5060c083015161363e60c08601826133d4565b5060e083015184820360e086015261365682826134ee565b91505061010083015161366d610100860182613561565b5061012083015184820361016086015261368782826130f7565b9150508091505092915050565b5f6020820190508181035f8301526136ac81846135a1565b905092915050565b5f6136be8261190d565b9050919050565b6136ce816136b4565b81146136d8575f5ffd5b50565b5f815190506136e9816136c5565b92915050565b5f5f6040838503121561370557613704611905565b5b5f61371285828601612667565b9250506020613723858286016136db565b9150509250929050565b5f6080820190506137405f830187611f80565b61374d6020830186611f80565b61375a6040830185611f80565b6137676060830184611c25565b95945050505050565b7f4173736f6369617465204661696c6564000000000000000000000000000000005f82015250565b5f6137a46010836126f8565b91506137af82613770565b602082019050919050565b5f6020820190508181035f8301526137d181613798565b9050919050565b5f6040820190506137eb5f830185611f80565b6137f86020830184611f80565b939250505056fea2646970667358221220a8a3df912624b51ed2eab24bfe0e87db053c0aa449463921a573917dad63c32d64736f6c634300081e0033";

        const createContract = new ContractCreateFlow()
            .setGas(5000000)
            .setBytecode(bytecode);

        const createContractTx = await createContract.execute(client);
        const createContractRx = await createContractTx.getReceipt(client);
        const contractId = createContractRx.contractId;

        console.log(`Contract created with ID: ${contractId} \n`);

        return contractId;
    } catch (err) {
        console.log(err);
        throw new Error('Contract creation Failed');
    }
}

export async function GET(req: NextRequest) {
    try {
        const contractId = await createContract();
        console.log(contractId);

        if (!contractId) {
            return NextResponse.json({ message: "ContractId not found" }, { status: 404 });
        }

        const smartContractFile = await fs.readFileSync('./model/TokenContract.sol', 'utf8');
        const metadataString = JSON.stringify(metadata);
        
        const body = JSON.stringify({
            address: `0x${contractId.toEvmAddress()}`,
            chain: '296',
            files: {
                "metadata.json": metadataString,
                "TokenManager.sol": smartContractFile,
            }
        });
        const result = await fetch('https://server-verify.hashscan.io/verify', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body
        })
        .then(response => {
            return response.json();
        })
        .catch(error => {
            console.log(error);
            throw new Error('Verification Falied');
        });

        return NextResponse.json({ success: true, contractId: `${contractId.realm}.${contractId.shard}.${contractId.num}` }, 
            { status: 201 });
    } catch (err) {
        console.log(err);
        return NextResponse.json({ success: false, error: err }, { status: 500 });
    }
}